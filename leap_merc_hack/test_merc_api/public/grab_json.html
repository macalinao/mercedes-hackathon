<!doctype html>
<html>
  <head>
    <title>Example</title>
  </head>
  <body>
    <div id='chartContainer' style='height: 300px; width:100%;'>
    </div>
    <script type='text/javascript' src='https://code.jquery.com/jquery-1.11.3.min.js'></script>
    <script type='text/javascript' src='http://canvasjs.com/assets/script/canvasjs.min.js'></script>
    <script>
      $(function() {
        var dps = []; // dataPoints
        var chart = new CanvasJS.Chart('chartContainer', {
          title: {
            text: 'Data'
          },
          data: [{
            type: 'line',
            dataPoints: dps
          }]
        });

        var xVal = 0;
        var yVal = 100;
        var updateInterval = 20;
        var dataLength = 500; // number of dataPoints visible at any point

        var updateChart = function(count) {
          count = count || 1;
          // count is number of times loop runs to generate random dataPoints.

          for (var j = 0; j < count; j++) {
            yVal = yVal + Math.round(5 + Math.random() * (-5 - 5));
            dps.push({
              x: xVal,
              y: yVal
            });
            xVal++;
          };
          if (dps.length > dataLength) {
            dps.shift();
          }

          chart.render();
        };

        // generates first set of dataPoints
        // updateChart(dataLength);

        // update chart after specified time.
        // setInterval(function(){updateChart()}, updateInterval);

        var counter = 0;

        (function poll() {


          $.ajax({
            url: '/latest',
            type: 'GET',
            success: function(data) {
              // do something here
              var jsonString = JSON.stringify(data, undefined, 4);
              console.log(data);
              dps.push({
                x: counter++,
                y: data.Accelerator_Pedal
              });
              if (dps.length > dataLength) {
                dps.shift();
              }
              chart.render();
            },
            dataType: 'json',
            crossDomain: true,
            complete: setTimeout(function() {

              poll();
            }, 200),
            timeout: 200
          });

        })();
      });
    </script>
  </body>
</html>
